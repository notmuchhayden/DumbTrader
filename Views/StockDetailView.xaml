<UserControl x:Class="DumbTrader.Views.StockDetailView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:scott="clr-namespace:ScottPlot.WPF;assembly=ScottPlot.WPF"
    mc:Ignorable="d"
    d:DesignHeight="600" d:DesignWidth="900">
    <Grid Background="{StaticResource Brush.Background}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 조회 버튼: 화면 좌상단 (옵션, 필요시 주석 해제) -->
        <!-- <Button Content="조회" Width="100" Height="30" Grid.Row="0" Grid.Column="0" HorizontalAlignment="Left" VerticalAlignment="Top" Command="{Binding QueryStockListCommand}"/> -->

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200" />
                <ColumnDefinition Width="5" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- 관심종목 (WatchlistView와 동일) -->
            <Border BorderBrush="{StaticResource Brush.Border}" BorderThickness="2" Grid.Column="0" Background="{StaticResource Brush.Card}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="40"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <TextBlock Text="관심종목" Style="{StaticResource TitleLarge}" HorizontalAlignment="Center"
                    VerticalAlignment="Center" Grid.Row="0"/>
                    <DataGrid Grid.Row="1" Margin="0" Background="{StaticResource Brush.CardAlt}"
                        BorderBrush="{StaticResource Brush.Border}" BorderThickness="1" AutoGenerateColumns="False"
                        HeadersVisibility="Column" Foreground="{StaticResource Brush.TextPrimary}" IsReadOnly="True"
                        ItemsSource="{Binding Watchlist}" CanUserResizeColumns="True"
                        SelectedItem="{Binding SelectedWatchlist, Mode=TwoWay}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="종목명" Binding="{Binding Stock.hname}" Width="*" />
                            <DataGridTextColumn Header="단축코드" Binding="{Binding Stock.shcode}" Width="*" />
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </Border>

            <!-- GridSplitter 추가 -->
            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Background="Gray" ShowsPreview="True"/>

            <!-- 개별 종목 설정 영역 -->
            <Border Grid.Column="2" BorderBrush="{StaticResource Brush.Border}" BorderThickness="2" Background="{StaticResource Brush.Card}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="40"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <TextBlock Text="개별 종목 설정" Style="{StaticResource TitleLarge}" HorizontalAlignment="Center" VerticalAlignment="Center" Grid.Row="0"/>
                    <Grid Grid.Row="1" Margin="10,10,10,10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <!-- 설정 -->
                        <GroupBox Header="설정" Margin="0,0,0,10" Background="{StaticResource Brush.CardAlt}" Grid.Row="0">
                            <Grid Margin="4" VerticalAlignment="Top">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <!-- 종목명 -->
                                <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="0">
                                    <TextBlock Text="종목명" Width="60" Margin="0,0,4,0" VerticalAlignment="Center"/>
                                    <TextBox Text="{Binding SelectedWatchlist.Stock.hname}" IsReadOnly="True" Width="100" VerticalAlignment="Center" Margin="0"/>
                                </StackPanel>
                                <!-- 단축코드 -->
                                <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Margin="0">
                                    <TextBlock Text="단축코드" Width="60" Margin="0,0,4,0" VerticalAlignment="Center"/>
                                    <TextBox Text="{Binding SelectedWatchlist.Stock.shcode}" IsReadOnly="True" Width="100" VerticalAlignment="Center" Margin="0"/>
                                </StackPanel>
                                <!-- ETF 구분 -->
                                <StackPanel Grid.Row="1" Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="0">
                                    <TextBlock Text="ETF 구분" Width="60" Margin="0,0,4,0" VerticalAlignment="Center"/>
                                    <TextBox Text="{Binding SelectedWatchlist.Stock.etfgubun}" IsReadOnly="True" Width="100" VerticalAlignment="Center" Margin="0"/>
                                </StackPanel>
                                <!-- 구분 -->
                                <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Margin="0">
                                    <TextBlock Text="구분" Width="60" Margin="0,0,4,0" VerticalAlignment="Center"/>
                                    <TextBox Text="{Binding SelectedWatchlist.Stock.gubun}" IsReadOnly="True" Width="100" VerticalAlignment="Center" Margin="0"/>
                                </StackPanel>
                                <!-- 확장코드 -->
                                <StackPanel Grid.Row="2" Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="0">
                                    <TextBlock Text="확장코드" Width="60" Margin="0,0,4,0" VerticalAlignment="Center"/>
                                    <TextBox Text="{Binding SelectedWatchlist.Stock.expcode}" IsReadOnly="True" Width="100" VerticalAlignment="Center" Margin="0"/>
                                </StackPanel>
                                <!-- 주전략/매도전략/매수전략 등은 필요시 추가 -->
                            </Grid>
                        </GroupBox>
                        <!-- 과거 데이터 -->
                        <GroupBox Header="과거 데이터" Background="{StaticResource Brush.CardAlt}" Grid.Row="1">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" /> <!-- Button -->
                                    <RowDefinition Height="*" /> <!-- DataGrid & Chart -->
                                </Grid.RowDefinitions>
                                <Button Content="과거데이터 조회" Command="{Binding QueryChartDataCommand}" Margin="0,0,0,8" Height="32" Width="140" HorizontalAlignment="Left" Grid.Row="0" />
                                <Grid Grid.Row="1">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="5" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <!-- DataGrid 왼쪽 -->
                                    <DataGrid 
                                        ItemsSource="{Binding ChartData}"
                                        AutoGenerateColumns="False"
                                        IsReadOnly="True"
                                        CanUserResizeColumns="True"
                                        HeadersVisibility="Column"
                                        Foreground="{StaticResource Brush.TextPrimary}"
                                        Background="{StaticResource Brush.CardAlt}"
                                        BorderBrush="{StaticResource Brush.Border}"
                                        BorderThickness="1"
                                        Grid.Column="0">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="종목코드" Binding="{Binding shcode}" Width="*" />
                                            <DataGridTextColumn Header="날짜" Binding="{Binding date}" Width="*" />
                                            <DataGridTextColumn Header="시가" Binding="{Binding open}" Width="*" />
                                            <DataGridTextColumn Header="고가" Binding="{Binding high}" Width="*" />
                                            <DataGridTextColumn Header="저가" Binding="{Binding low}" Width="*" />
                                            <DataGridTextColumn Header="종가" Binding="{Binding close}" Width="*" />
                                            <DataGridTextColumn Header="거래량" Binding="{Binding jdiff_vol}" Width="*" />
                                            <DataGridTextColumn Header="거래대금" Binding="{Binding value}" Width="*" />
                                            <!--<DataGridTextColumn Header="수정구분" Binding="{Binding jongchk}" Width="*" />
                                            <DataGridTextColumn Header="수정비율" Binding="{Binding rate}" Width="*" />
                                            <DataGridTextColumn Header="수정주가반영항목" Binding="{Binding pricechk}" Width="*" />
                                            <DataGridTextColumn Header="수정비율반영거래대금" Binding="{Binding ratevalue}" Width="*" />-->
                                            <DataGridTextColumn Header="등락구분" Binding="{Binding sign}" Width="*" />
                                        </DataGrid.Columns>
                                    </DataGrid>
                                    <!-- GridSplitter -->
                                    <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Background="Gray" ShowsPreview="True"/>
                                    <!-- CartesianChart 오른쪽 -->
                                    <scott:WpfPlot x:Name="WpfPlot" Grid.Column="2" Margin="8,0,0,0" />
                                </Grid>
                            </Grid>
                        </GroupBox>
                    </Grid>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</UserControl>
